# Technical Report - Class Assignment 2 - Part 2
### DevOps 23-24 JPE-PSM
#### Pedro Pires, 1231852

## Introduction

This report outlines my work on Class Assignment 2, Part 2 for the DevOps course.
The primary objective of this assignment is to transition a previously Maven-based project—specifically, the tutorial application `tut-react-and-spring-data-rest` to a Gradle-managed build system. This shift aligns with contemporary practices in software development, emphasizing automation, reproducibility, and efficiency in managing project dependencies and build processes.

In accordance with the assignment's requirements, this report will document the step-by-step process of converting the basic project setup from Maven to Gradle. It involves detailed descriptions of setting up the environment, configuring Gradle tasks, and integrating plugins essential for managing both the backend and frontend components of the application. This exercise not only enhances the learning experience but also deepens the understanding of build tools, which are pivotal in modern software development pipelines.

The repository can be found [here](https://github.com/pedrodgp/devops-23-24-JPE-PSM-1231852).

## Index
1. [Getting Started](#getting-started)
2. [Add a task to gradle to copy the generated jar](#add-a-task-to-gradle-to-copy-the-generated-jar)
3. [Add a task to gradle to delete all the files generated by webpack before the task clean](#add-a-task-to-gradle-to-delete-all-the-files-generated-by-webpack-before-the-task-clean)
4. [Alternative Approach (Maven)](#alternative-approach-maven)
5. [Conclusion](#conclusion)

## Getting Started

1. **Create the first issue** in the repository to track the changes that will be made:

- #### Issue #1
     - **Tittle:** ```CA2 p2 - Migrate tut-react-and-spring-data-rest from Maven to Gradle```
       The aim of Part 2 is to transition the _tut-react-and-spring-data-rest_ (CA1) from **Maven** to **Gradle**. The process involves:

2. **Branching**: Create and switch to a new branch named `tut-basic-gradle`.

In the command line, use the following commands to create and switch to the new branch:
```bash
git checkout main
git branch tut-basic-gradle
git checkout tut-basic-gradle
```

3. After creating the issue, **create a new folder** for the assignment, create the folder `CA2/Part2`.

4. **Project Setup**: Use [start.spring.io](https://start.spring.io) to initiate a new Gradle Spring Boot project with dependencies: Rest Repositories, Thymeleaf, JPA, and H2. Extract this to `CA2/Part2/`.

![Spring Initializr](https://i.ibb.co/v19J1fS/Captura-de-ecr-2024-04-15-150448.png)

5. Delete the new project's `src` directory. Copy the `src` folder, `webpack.config.js`, and `package.json` from the basic version (CA1 folder). Don't forget to remove `src/main/resources/static/built/`.

In the `CA2/Part2/react-and-spring-data-rest-basic/src/main/java/com/greglturnquist/payroll/Employee.java` class you must change the import:

```JAVA
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
```

To:

```JAVA
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import jakarta.persistence.GeneratedValue;
```

6.  Add the gradle plugin `org.siouan.frontend` to the project so that gradle is also able to manage the frontend.
At the `build.gradle` file, add the following code `id "org.siouan.frontend-jdk17" version "8.0.0"` in the plugins section:

```gradle
plugins {
	id 'java'
	id 'org.springframework.boot' version '3.2.4'
	id 'io.spring.dependency-management' version '1.1.4'
	id "org.siouan.frontend-jdk17" version "8.0.0"
}
```

7. Add the following code in `build.gradle` to configure the previous plug-in and to include the packageManager:

```gradle
frontend {
 2 nodeVersion ="16.20.2"
 3 assembleScript ="run build"
 4 cleanScript ="runclean"
 5 checkScript ="runcheck"
 6 }
```

```gradle
"packageManager": "npm@9.6.7",
```

8. Update the scripts section/object in `package.json` to configure the execution of webpack, should look like this:

```json
  "scripts": {
"watch": "webpack --watch -d --output ./target/classes/static/built/bundle.js",
"webpack": "webpack",
"build": "npm run webpack",
"check": "echo Checking frontend",
"clean": "echo Cleaning frontend",
"lint": "echo Linting frontend",
"test": "echo Testing frontend"
},
```



9. You can now execute `./gradlew build` and execute the application by using `./gradlew bootRun`. Should be able to access the application at `http://localhost:8080/`.
And the application should look like this:

![image](https://i.postimg.cc/HkJ5zNj1/Captura-de-ecr-2024-03-13-235000.png)

10. Commit the changes and close the issue.



##  Add a task to gradle to copy the generated jar

This segment of the assignment is conducted on the **tut-basic-gradle branch**, with the objective of adding a task to
gradle to copy the generated jar to a folder named `dist` **located a the project root folder level.**

1. **Create a new issue** in the repository to track the changes that will be made.
- #### Issue #2
  - **Tittle:** ```CA2 p2 - Add a gradle task to copy the generated jar```
  - **Description:** ```Add a task to gradle to copy the generated jar to a folder named ”dist” located a the project root folder level.```

2. Open the `build.gradle` file in the project's root directory and add the following task to the file:
```gradle
task copyJar(type: Copy) {
	from bootJar.outputs
	into file("dist")
}
```
* The `from bootJar.outputs` copies the jar file generated by the bootJar task.
* The `into file("dist")` copies the jar file to the `dist` folder located at the project root level.

3. Run the task `copyJar` with the command `./gradlew copyJar` to copy the generated jar file to the `dist` folder. If the task is successful, you should see the jar file in the `dist` folder.

![Dist Folder](https://i.ibb.co/TvWTy6N/Captura-de-ecr-2024-04-15-144242.png)


4. Commit the changes and close the issue.


## Add a task to gradle to delete all the files generated by webpack before the task clean.

This segment of the assignment is conducted on the **main branch**, with the objective of adding a task to gradle to delete all the files generated by webpack (usually located at
src/resources/main/static/built/). **This new task should be executed automatically by gradle before the task clean.**

1. **Create a new issue** in the repository to track the changes that will be made.

- #### Issue #2
    - **Tittle:** ```CA2 p2 - Add a gradle task to delete all the files generated by webpack```
    - **Description:** ```Add a task to gradle to delete all the files generated by webpack (usually located at src/resources/main/static/built/).
      This new task should be executed automatically by gradle before the task clean.```

2. Open the `build.gradle` file in the project's root directory and add the following task to the file:

```gradle
task deleteWebpackFiles(type: Delete) {
	delete fileTree(dir: 'src/main/resources/static/built')
}

clean.dependsOn deleteWebpackFiles
}
```

* The `deleteWebpackFiles` task deletes all the files generated by webpack located at `src/main/resources/static/built`.
* The `clean.dependsOn deleteWebpackFiles` ensures that the `deleteWebpackFiles` task runs before the `clean` task.


3. If you run the task `clean` with the command `./gradlew clean`, the contents of the `src/main/resources/static/built` folder will be deleted.

4. Commit the changes and close the issue.



